
>索引是 MySQL 中用于提高查询效率的关键机制，其本质是数据库表中一列或多列值的有序数据结构，通过索引可以快速定位数据，而不用每次都全表扫描

# 1. 概述

## 1.1 索引的创建

1、 使用 CREATE 语句

```sql
-- 普通索引
CREATE INDEX 索引名 ON 表名 (字段名(length) [ASC|DESC]);

-- 唯一索引
CREATE UNIQUE INDEX 索引名 ON 表名(字段名);

-- 组合索引
CREATE INDEX 索引名 ON 表名(字段1, 字段2);
```

2、使用 ALTER 语句

```sql
-- 普通索引
ALTER TABLE 表名 ADD INDEX 索引名(字段名(length) [ASC|DESC]);

-- 唯一索引
ALTER TABLE 表名 ADD UNIQUE INDEX 索引名(字段名);

-- 组合索引
ALTER TABLE 表名 ADD INDEX 索引名(字段1,字段2);
```

3、建表时 DDL 语句中创建

```sql
CREATE TABLE 表名(  
  字段1 INT(8) NOT NULL,   
  字段2 ....,
  .....,
  INDEX 索引名 (字段名(length))  
);
```

****
## 1.2 查询、删除、指定索引

1、查询索引

```sql
SHOW INDEX FROM 表名;
```

![](images/索引/file-20250522173148.png)

- `Non_unique`：是否唯一索引（0 表示唯一，1 表示非唯一）
- `Key_name`：索引名称（如 PRIMARY）
- `Seq_in_index`：索引中字段的顺序（1 表示第一个字段）
- `Column_name`：被索引的列名
- `Collation`：列在索引中的排序方式：`A` 表示升序，`D` 表示降序，`NULL` 表示未排序
- `Cardinality`：基数，表示索引中唯一值的估计数量（影响查询优化器选择）
- `Sub_part`：索引的前缀长度(如果是部分索引)，`NULL` 表示整列被索引
- `Packed`：键是否被压缩，`NULL` 表示未压缩
- `Null`：列是否允许包含 NULL 值
- `Index_type`：索引类型，如 BTREE、FULLTEXT

2、删除索引

```sql
ALTER TABLE 表名 DROP INDEX 索引名;
```

>需要注意的是：不能通过 `DROP INDEX` 删除主键索引，需要用 `DROP PRIMARY KEY` 

3、指定索引

MySQL 默认由查询优化器选择最优索引，但可以通过以下方式手动指定使用某个索引：

```sql
-- 强制使用某个索引，哪怕优化器认为其他方式更快
SELECT * FROM 表名 FORCE INDEX (索引名) WHERE 条件;

-- 建议使用指定索引，但如果优化器认为不可行，可不使用
SELECT * FROM 表名 USE INDEX (索引名) WHERE 条件;

-- 告诉优化器不要使用某个索引
SELECT * FROM 表名 IGNORE INDEX (索引名) WHERE 条件;
```

****
## 1.3 索引的本质

>索引本质上是磁盘上的一种特殊数据结构文件，它和表一样都是物理数据的一部分，因此与表数据相同，最终创建出的索引也会在磁盘生成本地文件，不过索引文件在磁盘中的存储方式是由索引的数据结构来决定的，同时，由于索引机制最终是由存储引擎实现，因此不同存储引擎下的索引文件保存在本地的格式也并不相同

需要注意的是：

>创建索引并不是单纯的给表添加一个约束，而是基于原表的数据，重新在磁盘中创建新的本地索引文件，假设表中有一千万条数据，那创建索引时，就需要将索引字段上的一千万个值全部拷贝到本地索引文件中，同时做好排序并与表数据产生映射关系

****
# 2. 索引的分类

## 2.1 功能层次

|类型|简要说明|适用场景|
|---|---|---|
|**主键索引（PRIMARY KEY）**|表中唯一的主键，不能重复，不能为空|用于唯一标识一条记录|
|**唯一索引（UNIQUE）**|索引列的值必须唯一，但可以为 `NULL`|限制列值不能重复，如身份证号、邮箱|
|**普通索引（INDEX / KEY）**|没有限制的索引，值可重复可为空|提高普通字段查询效率|
|**组合索引（联合索引）**|多个字段组成一个索引|支持多个字段作为筛选条件的查询|
|**全文索引（FULLTEXT）**|用于文本搜索，可分词匹配|适合对大文本字段（如文章）做模糊搜索|
|**空间索引（SPATIAL）**|用于存储几何数据的字段|多用于地理信息系统（GIS）应用|

### 1. 主键索引（PRIMARY KEY）

>表中只能有一个主键索引，自动具有唯一性约束，不能为 `NULL`，在 InnoDB 中主键索引就是聚簇索引

```sql
CREATE TABLE user (
  id INT PRIMARY KEY,
  name VARCHAR(50)
);
```

****
### 2. 唯一索引（UNIQUE）

>保证列中的数据是唯一不可重复的，但允许 `NULL`（多个 NULL 也是允许的），也可以创建多个唯一索引

```sql
CREATE UNIQUE INDEX 索引名 ON 表名(字段);
```

****
### 3. 普通索引（INDEX / KEY）

>没有唯一性限制，可以重复，主要是提高 `WHERE` 、`ORDER BY` 的查询效率

```sql
CREATE INDEX 索引名 ON 表名(字段);
```

****
### 4. 组合索引

>由多个列组成的索引，常用于多条件查询，遵循最左前缀原则：只要满足索引列的最左边一部分（即满足字段 1），也能被使用

```sql
CREATE INDEX 索引名 ON 表名(字段1, 字段2);

CREATE INDEX name_age ON user(name, age);
SELECT * FROM user WHERE age = 18; -- 这种查询就用不上组合索引
```

****
### 5. 全文索引

>支持自然语言的分词搜索，适合大文本内容，但只支持 `CHAR`、`VARCHAR`、`TEXT`，仅 InnoDB（MySQL 5.6+）和 MyISAM 支持

```sql
CREATE TABLE 表名 (
  id INT PRIMARY KEY,
  content TEXT,
  FULLTEXT(content)
);
```

```sql
SELECT * FROM 表名 WHERE MATCH(字段) AGAINST('具体内容');
```

****
### 6. 空间索引

>用于几何数据类型（如 `POINT`、`LINESTRING`），只能用于 MyISAM 引擎（InnoDB 也在支持中，但受限较多）

****
## 2.2 数据结构层次

| 数据结构       | 索引类型        | 特点              |
| ---------- | ----------- | --------------- |
| **B+ 树索引** | 主键、唯一、普通、组合 | 默认结构，适合范围查找     |
| **哈希索引**   | MEMORY 引擎   | 快速定位，无法排序或做范围查找 |
| **倒排索引**   | 全文索引        | 支持关键字搜索、模糊匹配    |
| **R-Tree** | 空间索引        | 专用于二维空间坐标查找     |
1、哈希索引

>Hash 索引是比较常见的一种索引，他的单条记录查询的效率很高，时间复杂度为 1，但是 Hash 索引并不是最常用的数据库索引类型

需要注意的是 Hash 索引适合精确查找，但是范围查找不适合：

>因为存储引擎会为每一行计算一个 hash 值，hash 值都是比较小的，并且不同键值行的 hash 码通常是不一样的，hash 索引中存储的就是 Hash 码，hash 码彼此之间是没有规律的，且 Hash 操作并不能保证顺序性，所以值相近的两个数据，Hash值相差很远，被分到不同的桶中。这就是为什么hash索引只能进行全职匹配的查询，因为只有这样，hash码才能够匹配到数据。


****






